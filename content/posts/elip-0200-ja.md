---
date: '2025-03-24T16:56:49+09:00'
title: 'elip-0200'
---

ELIP 0200の日本語訳をおいておく。
ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。  

この記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。  
なお、この記事は、commit hash[9f08b8168328691c1bff6e0261cebbe985f39ae4](https://github.com/ElementsProject/ELIPs/tree/9f08b8168328691c1bff6e0261cebbe985f39ae4) 時点のものとなっている。

---

      ELIP: 200  
      Layer: Applications  
      Title: Confidential Transactions の割引料金  
      Author: Byron Hambly <bhambly@blockstream.com>  
      Comments-Summary: まだコメントはありません。  
      Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200  
      Status: Draft  
      Type: Standards Track  
      Created: 2024-06-19  
      License: BSD-3-Clause

## はじめに

### 概要

本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。

### Copyright

本書は 3 条項 BSD ライセンスの下で公開されております。

### Motivation

Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。

これらはサイズが大きいため、 CT は明示的な取引に比して桁違いに高い取引手数料を必要といたします。そのため、手数料を最小化しようとする行為者が、 CT によるプライバシー向上よりも明示的な取引を選好する動機付けを受ける可能性がございます。CT を促進するため、本 ELIP では、Elements において割引された手数料率で CT を受け入れリレーするというポリシー変更を提案いたします。この割引により、 CT の手数料は明示的な取引と同程度の規模となり、明示的な取引を使用するインセンティブが低減されることとなります。

## Design

### Overview

「discount virtual size」␣( discountvsize )␣の新たな計算方法を提案いたします。明示的な取引においては、これは取引の vsize と全く同じ値となります。CT においては、取引内の各秘密の出力毎に、仮想取引サイズの計算前に取引の重みが減少されます。

ウォレットでは、接続されている Elements ノードがそのような割引 CT を受け入れリレーする設定となっていることを前提に、取引生成時の手数料見積もりのためにこの割引計算が使用されます。

ノードの場合、このディスカウント計算はメンプール受け入れ検証およびピア間メッセージングにおいて、どのトランザクションを中継するかを決定する際に利用されます。

### 欠点

discountvsize を利用して料金計算を行うことにより、ディスカウント CT はトランザクション作成時に指定された料金率よりも低い *実際* の料金率となります。現在、ブロックアセンブラはまず最も高い先祖料金率を持つトランザクションパッケージを選択します。これにより、ディスカウント CT は、同じ表面上の料金率の場合、明示的トランザクションやディスカウントされていない CT の後にしか選択されません。提案されている解決策は、ブロックアセンブラにおけるトランザクションの並び順を、ディスカウントされた仮想サイズに基づく料金率に変更することです。これにより、ブロックテンプレートはもはや料金の最大化を行わなくなりますが、料金が低減された上で CT のプライバシーを優先するため、許容可能なトレードオフと見なされます。

### 仕様

#### ウォレット

ウォレットは通常通りにトランザクションを構築することができ、料金出力にプレースホルダー金額を含めます。ダミー署名を埋め込んだ後、トランザクションのウエイトは BIP-0141[^1] に従って計算されるべきです：

`Weight = Base transaction size * 3 + Total transaction size`

次に：

`Base transaction size` は、ウィットネスデータを除去した状態でシリアライズされたトランザクションのサイズです。

`Total transaction size` は、BIP-0144[^2] に記載されている方法でシリアライズされたバイト単位のトランザクションサイズで、ベースデータとウィットネスデータの両方を含みます。

ディスカウントウエイトを計算するために、各出力について：

-   出力ウィットネスが存在する場合、そのウエイトを減算し、代わりに空のウィットネスを表す 2 ウエイト単位を残す
-   金額がコミットメントの場合、ウエイト 96 （24 * 4）単位を減算する。これは、コミットメント（33 バイト）と明示的金額（9 バイト）の差に対して、ウィットデータではないため 4 倍される結果である
-   ノンスがコミットメントの場合、ウエイト 128 （32 * 4）単位を減算する。これは、コミットメント（33 バイト）とノンスなし（1 バイト）の差に対して、ウィットデータではないため 4 倍される結果である

次に、`(discount weight + 3) / 4` として discountvsize を計算し、料金出力金額を `chosen fee rate * discountvsize` に設定します。

手数料出力は、ウィットネスやノンスが含まれておらず、金額が明示されているため、割引計算の目的上、無視してもよいです。  

##### 計算例 {#example_calculation}

LiquidV1[^3] のトランザクション：  

このトランザクションには 2 個 のコンフィデンシャル出力と 1 個 の手数料出力が含まれております。  

重み： 10536 WU  

-   最初の出力ウィットネス (4277) - 2： 10536 - 4275 = 6261  
-   金額コミットメント分 96 を減算： 6261 - 96 = 6165  
-   ノンスコミットメント分 128 を減算： 6165 - 128 = 6037  
-   二番目の出力ウィットネス (4277) - 2 を減算： 6037 - 4275 = 1762  
-   金額コミットメント分 96 を減算： 1762 - 96 = 1666  
-   ノンスコミットメント分 128 を減算： 1666 - 128 = 1538  

割引後の重み： 1538 WU  

割引後の仮想サイズ： (1538 + 3) / 4 = 385 vB  

#### ノード

ノードは、これらの割引 CT を受け入れ、リレーするか否かを定義する新たな設定オプションを追加する必要があります。参照実装では、これを "accept_discount_ct" と呼んでいます。  
この設定オプションが有効な場合、ノードはミンプールへの受け入れのための手数料率計算およびピアから与えられるフィルタ手数料率に応じたインベントリメッセージへの応答において、vsize の代わりに discountvsize を用いなければなりません。  

ブロックテンプレートアセンブラにおいて、先祖手数料率による順序付けも、手数料あたりの vsize ではなく、手数料あたりの discountvsize を用いるように変更されるべきです。  

## 後方互換性 {#backwards_compatibility}

任意の手数料率、または手数料出力が存在しないトランザクションであっても、LiquidV1 ではコンセンサス上有効であり、Elements ではデフォルトでブロックに含めることが可能です。  
Elements の現在のデフォルト最低手数料率（0.1 sats/vb）において、上記で規定された割引 CT はアップグレードされていないノードによってリレーされるための最低手数料率を満たしません。  
割引 CT がアップグレードされたノードを介してブロックマイナ（または署名者）ノードにリレーされることができれば、ブロックに含めることが可能です。  
アップグレードされたノードが増えるにつれて、これは容易になります。  

## 参照実装 {#reference_implementation}
<https://github.com/ElementsProject/elements/pull/1317>

## 代替実装 {#alternate_implementation}
<https://github.com/ElementsProject/rust-elements/pull/204>

## 参考文献

<references />

[^1]: BIP-0141：
    <https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki>
    #Transaction_size_calculations

[^2]: BIP-0144：
    <https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki>
    #user-content-Serialization

[^3]: <https://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988>
