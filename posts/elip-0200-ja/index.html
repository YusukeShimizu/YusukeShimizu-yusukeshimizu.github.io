<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>elip-0200 | blog</title>
<meta name=keywords content><meta name=description content="ELIP 0200の日本語訳をおいておく。
ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。
この記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。
なお、この記事は、commit hash9f08b8168328691c1bff6e0261cebbe985f39ae4 時点のものとなっている。

      ELIP: 200
      Layer: Applications
      Title: Confidential Transactions の割引料金
      Author: Byron Hambly bhambly@blockstream.com
      Comments-Summary: まだコメントはありません。
      Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200
      Status: Draft
      Type: Standards Track
      Created: 2024-06-19
      License: BSD-3-Clause
はじめに
概要
本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。
Copyright
本書は 3 条項 BSD ライセンスの下で公開されております。
Motivation
Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。"><meta name=author content><link rel=canonical href=https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://yusukeshimizu.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yusukeshimizu.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yusukeshimizu.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://yusukeshimizu.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://yusukeshimizu.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/"><meta property="og:site_name" content="blog"><meta property="og:title" content="elip-0200"><meta property="og:description" content="ELIP 0200の日本語訳をおいておく。 ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。
この記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。
なお、この記事は、commit hash9f08b8168328691c1bff6e0261cebbe985f39ae4 時点のものとなっている。
ELIP: 200
Layer: Applications
Title: Confidential Transactions の割引料金
Author: Byron Hambly bhambly@blockstream.com
Comments-Summary: まだコメントはありません。
Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200
Status: Draft
Type: Standards Track
Created: 2024-06-19
License: BSD-3-Clause
はじめに 概要 本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。
Copyright 本書は 3 条項 BSD ライセンスの下で公開されております。
Motivation Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-24T16:56:49+09:00"><meta property="article:modified_time" content="2025-03-24T16:56:49+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="elip-0200"><meta name=twitter:description content="ELIP 0200の日本語訳をおいておく。
ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。
この記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。
なお、この記事は、commit hash9f08b8168328691c1bff6e0261cebbe985f39ae4 時点のものとなっている。

      ELIP: 200
      Layer: Applications
      Title: Confidential Transactions の割引料金
      Author: Byron Hambly bhambly@blockstream.com
      Comments-Summary: まだコメントはありません。
      Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200
      Status: Draft
      Type: Standards Track
      Created: 2024-06-19
      License: BSD-3-Clause
はじめに
概要
本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。
Copyright
本書は 3 条項 BSD ライセンスの下で公開されております。
Motivation
Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yusukeshimizu.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"elip-0200","item":"https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"elip-0200","name":"elip-0200","description":"ELIP 0200の日本語訳をおいておく。 ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。\nこの記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。\nなお、この記事は、commit hash9f08b8168328691c1bff6e0261cebbe985f39ae4 時点のものとなっている。\nELIP: 200\nLayer: Applications\nTitle: Confidential Transactions の割引料金\nAuthor: Byron Hambly bhambly@blockstream.com\nComments-Summary: まだコメントはありません。\nComments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200\nStatus: Draft\nType: Standards Track\nCreated: 2024-06-19\nLicense: BSD-3-Clause\nはじめに 概要 本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。\nCopyright 本書は 3 条項 BSD ライセンスの下で公開されております。\nMotivation Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。\n","keywords":[],"articleBody":"ELIP 0200の日本語訳をおいておく。 ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。\nこの記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。\nなお、この記事は、commit hash9f08b8168328691c1bff6e0261cebbe985f39ae4 時点のものとなっている。\nELIP: 200\nLayer: Applications\nTitle: Confidential Transactions の割引料金\nAuthor: Byron Hambly bhambly@blockstream.com\nComments-Summary: まだコメントはありません。\nComments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200\nStatus: Draft\nType: Standards Track\nCreated: 2024-06-19\nLicense: BSD-3-Clause\nはじめに 概要 本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。\nCopyright 本書は 3 条項 BSD ライセンスの下で公開されております。\nMotivation Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。\nこれらはサイズが大きいため、 CT は明示的な取引に比して桁違いに高い取引手数料を必要といたします。そのため、手数料を最小化しようとする行為者が、 CT によるプライバシー向上よりも明示的な取引を選好する動機付けを受ける可能性がございます。CT を促進するため、本 ELIP では、Elements において割引された手数料率で CT を受け入れリレーするというポリシー変更を提案いたします。この割引により、 CT の手数料は明示的な取引と同程度の規模となり、明示的な取引を使用するインセンティブが低減されることとなります。\nDesign Overview 「discount virtual size」␣( discountvsize )␣の新たな計算方法を提案いたします。明示的な取引においては、これは取引の vsize と全く同じ値となります。CT においては、取引内の各秘密の出力毎に、仮想取引サイズの計算前に取引の重みが減少されます。\nウォレットでは、接続されている Elements ノードがそのような割引 CT を受け入れリレーする設定となっていることを前提に、取引生成時の手数料見積もりのためにこの割引計算が使用されます。\nノードの場合、このディスカウント計算はメンプール受け入れ検証およびピア間メッセージングにおいて、どのトランザクションを中継するかを決定する際に利用されます。\n欠点 discountvsize を利用して料金計算を行うことにより、ディスカウント CT はトランザクション作成時に指定された料金率よりも低い 実際 の料金率となります。現在、ブロックアセンブラはまず最も高い先祖料金率を持つトランザクションパッケージを選択します。これにより、ディスカウント CT は、同じ表面上の料金率の場合、明示的トランザクションやディスカウントされていない CT の後にしか選択されません。提案されている解決策は、ブロックアセンブラにおけるトランザクションの並び順を、ディスカウントされた仮想サイズに基づく料金率に変更することです。これにより、ブロックテンプレートはもはや料金の最大化を行わなくなりますが、料金が低減された上で CT のプライバシーを優先するため、許容可能なトレードオフと見なされます。\n仕様 ウォレット ウォレットは通常通りにトランザクションを構築することができ、料金出力にプレースホルダー金額を含めます。ダミー署名を埋め込んだ後、トランザクションのウエイトは BIP-01411 に従って計算されるべきです：\nWeight = Base transaction size * 3 + Total transaction size\n次に：\nBase transaction size は、ウィットネスデータを除去した状態でシリアライズされたトランザクションのサイズです。\nTotal transaction size は、BIP-01442 に記載されている方法でシリアライズされたバイト単位のトランザクションサイズで、ベースデータとウィットネスデータの両方を含みます。\nディスカウントウエイトを計算するために、各出力について：\n出力ウィットネスが存在する場合、そのウエイトを減算し、代わりに空のウィットネスを表す 2 ウエイト単位を残す 金額がコミットメントの場合、ウエイト 96 （24 * 4）単位を減算する。これは、コミットメント（33 バイト）と明示的金額（9 バイト）の差に対して、ウィットデータではないため 4 倍される結果である ノンスがコミットメントの場合、ウエイト 128 （32 * 4）単位を減算する。これは、コミットメント（33 バイト）とノンスなし（1 バイト）の差に対して、ウィットデータではないため 4 倍される結果である 次に、(discount weight + 3) / 4 として discountvsize を計算し、料金出力金額を chosen fee rate * discountvsize に設定します。\n手数料出力は、ウィットネスやノンスが含まれておらず、金額が明示されているため、割引計算の目的上、無視してもよいです。\n計算例 LiquidV13 のトランザクション：\nこのトランザクションには 2 個 のコンフィデンシャル出力と 1 個 の手数料出力が含まれております。\n重み： 10536 WU\n最初の出力ウィットネス (4277) - 2： 10536 - 4275 = 6261 金額コミットメント分 96 を減算： 6261 - 96 = 6165 ノンスコミットメント分 128 を減算： 6165 - 128 = 6037 二番目の出力ウィットネス (4277) - 2 を減算： 6037 - 4275 = 1762 金額コミットメント分 96 を減算： 1762 - 96 = 1666 ノンスコミットメント分 128 を減算： 1666 - 128 = 1538 割引後の重み： 1538 WU\n割引後の仮想サイズ： (1538 + 3) / 4 = 385 vB\nノード ノードは、これらの割引 CT を受け入れ、リレーするか否かを定義する新たな設定オプションを追加する必要があります。参照実装では、これを “accept_discount_ct” と呼んでいます。\nこの設定オプションが有効な場合、ノードはミンプールへの受け入れのための手数料率計算およびピアから与えられるフィルタ手数料率に応じたインベントリメッセージへの応答において、vsize の代わりに discountvsize を用いなければなりません。\nブロックテンプレートアセンブラにおいて、先祖手数料率による順序付けも、手数料あたりの vsize ではなく、手数料あたりの discountvsize を用いるように変更されるべきです。\n後方互換性 任意の手数料率、または手数料出力が存在しないトランザクションであっても、LiquidV1 ではコンセンサス上有効であり、Elements ではデフォルトでブロックに含めることが可能です。\nElements の現在のデフォルト最低手数料率（0.1 sats/vb）において、上記で規定された割引 CT はアップグレードされていないノードによってリレーされるための最低手数料率を満たしません。\n割引 CT がアップグレードされたノードを介してブロックマイナ（または署名者）ノードにリレーされることができれば、ブロックに含めることが可能です。\nアップグレードされたノードが増えるにつれて、これは容易になります。\n参照実装 https://github.com/ElementsProject/elements/pull/1317\n代替実装 https://github.com/ElementsProject/rust-elements/pull/204\n参考文献 BIP-0141： https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki #Transaction_size_calculations ↩︎\nBIP-0144： https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki #user-content-Serialization ↩︎\nhttps://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988 ↩︎\n","wordCount":"295","inLanguage":"en","datePublished":"2025-03-24T16:56:49+09:00","dateModified":"2025-03-24T16:56:49+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/"},"publisher":{"@type":"Organization","name":"blog","logo":{"@type":"ImageObject","url":"https://yusukeshimizu.github.io/blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yusukeshimizu.github.io/blog/ accesskey=h title="blog (Alt + H)">blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">elip-0200</h1><div class=post-meta><span title='2025-03-24 16:56:49 +0900 +0900'>March 24, 2025</span></div></header><div class=post-content><p>ELIP 0200の日本語訳をおいておく。
ELIPはElements Improvement Proposals, or ELIPs. つまり、Elementsプロジェクトの改善提案書であり、BitcoinのBIPに相当するものである。</p><p>この記事は、llmにより翻訳されたものであり、内容に誤りがある可能性はある。<br>なお、この記事は、commit hash<a href=https://github.com/ElementsProject/ELIPs/tree/9f08b8168328691c1bff6e0261cebbe985f39ae4>9f08b8168328691c1bff6e0261cebbe985f39ae4</a> 時点のものとなっている。</p><hr><p>      ELIP: 200<br>      Layer: Applications<br>      Title: Confidential Transactions の割引料金<br>      Author: Byron Hambly <a href=mailto:bhambly@blockstream.com>bhambly@blockstream.com</a><br>      Comments-Summary: まだコメントはありません。<br>      Comments-URI: <a href=https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200>https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200</a><br>      Status: Draft<br>      Type: Standards Track<br>      Created: 2024-06-19<br>      License: BSD-3-Clause</p><h2 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h2><h3 id=概要>概要<a hidden class=anchor aria-hidden=true href=#概要>#</a></h3><p>本書は Confidential Transactions の料金を削減する方法を提案いたします。ウォレットが割引料金を算出するために利用できる計算方法および、これらの割引取引をリレーおよび採掘するために必要な Elements ノードの変更点を定めます。</p><h3 id=copyright>Copyright<a hidden class=anchor aria-hidden=true href=#copyright>#</a></h3><p>本書は 3 条項 BSD ライセンスの下で公開されております。</p><h3 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h3><p>Elements では、 Confidential Transactions ␣( CT )␣は通常の明示的な取引より約 10 倍大きくなっております。出力額は Pedersen コミットメント に置き換えられており、さらに追加の アセット コミットメント と ECDH エフェメラル キー が含まれております。出力にはさらに追加のウィットネスデータが含まれており：金額が有効な範囲内であることを示すレンジプルーフ と、出力のアセットが入力のアセットと一致することを示すサージェクションプルーフ を備えております。</p><p>これらはサイズが大きいため、 CT は明示的な取引に比して桁違いに高い取引手数料を必要といたします。そのため、手数料を最小化しようとする行為者が、 CT によるプライバシー向上よりも明示的な取引を選好する動機付けを受ける可能性がございます。CT を促進するため、本 ELIP では、Elements において割引された手数料率で CT を受け入れリレーするというポリシー変更を提案いたします。この割引により、 CT の手数料は明示的な取引と同程度の規模となり、明示的な取引を使用するインセンティブが低減されることとなります。</p><h2 id=design>Design<a hidden class=anchor aria-hidden=true href=#design>#</a></h2><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><p>「discount virtual size」␣( discountvsize )␣の新たな計算方法を提案いたします。明示的な取引においては、これは取引の vsize と全く同じ値となります。CT においては、取引内の各秘密の出力毎に、仮想取引サイズの計算前に取引の重みが減少されます。</p><p>ウォレットでは、接続されている Elements ノードがそのような割引 CT を受け入れリレーする設定となっていることを前提に、取引生成時の手数料見積もりのためにこの割引計算が使用されます。</p><p>ノードの場合、このディスカウント計算はメンプール受け入れ検証およびピア間メッセージングにおいて、どのトランザクションを中継するかを決定する際に利用されます。</p><h3 id=欠点>欠点<a hidden class=anchor aria-hidden=true href=#欠点>#</a></h3><p>discountvsize を利用して料金計算を行うことにより、ディスカウント CT はトランザクション作成時に指定された料金率よりも低い <em>実際</em> の料金率となります。現在、ブロックアセンブラはまず最も高い先祖料金率を持つトランザクションパッケージを選択します。これにより、ディスカウント CT は、同じ表面上の料金率の場合、明示的トランザクションやディスカウントされていない CT の後にしか選択されません。提案されている解決策は、ブロックアセンブラにおけるトランザクションの並び順を、ディスカウントされた仮想サイズに基づく料金率に変更することです。これにより、ブロックテンプレートはもはや料金の最大化を行わなくなりますが、料金が低減された上で CT のプライバシーを優先するため、許容可能なトレードオフと見なされます。</p><h3 id=仕様>仕様<a hidden class=anchor aria-hidden=true href=#仕様>#</a></h3><h4 id=ウォレット>ウォレット<a hidden class=anchor aria-hidden=true href=#ウォレット>#</a></h4><p>ウォレットは通常通りにトランザクションを構築することができ、料金出力にプレースホルダー金額を含めます。ダミー署名を埋め込んだ後、トランザクションのウエイトは BIP-0141<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> に従って計算されるべきです：</p><p><code>Weight = Base transaction size * 3 + Total transaction size</code></p><p>次に：</p><p><code>Base transaction size</code> は、ウィットネスデータを除去した状態でシリアライズされたトランザクションのサイズです。</p><p><code>Total transaction size</code> は、BIP-0144<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> に記載されている方法でシリアライズされたバイト単位のトランザクションサイズで、ベースデータとウィットネスデータの両方を含みます。</p><p>ディスカウントウエイトを計算するために、各出力について：</p><ul><li>出力ウィットネスが存在する場合、そのウエイトを減算し、代わりに空のウィットネスを表す 2 ウエイト単位を残す</li><li>金額がコミットメントの場合、ウエイト 96 （24 * 4）単位を減算する。これは、コミットメント（33 バイト）と明示的金額（9 バイト）の差に対して、ウィットデータではないため 4 倍される結果である</li><li>ノンスがコミットメントの場合、ウエイト 128 （32 * 4）単位を減算する。これは、コミットメント（33 バイト）とノンスなし（1 バイト）の差に対して、ウィットデータではないため 4 倍される結果である</li></ul><p>次に、<code>(discount weight + 3) / 4</code> として discountvsize を計算し、料金出力金額を <code>chosen fee rate * discountvsize</code> に設定します。</p><p>手数料出力は、ウィットネスやノンスが含まれておらず、金額が明示されているため、割引計算の目的上、無視してもよいです。</p><h5 id=example_calculation>計算例<a hidden class=anchor aria-hidden=true href=#example_calculation>#</a></h5><p>LiquidV1<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> のトランザクション：</p><p>このトランザクションには 2 個 のコンフィデンシャル出力と 1 個 の手数料出力が含まれております。</p><p>重み： 10536 WU</p><ul><li>最初の出力ウィットネス (4277) - 2： 10536 - 4275 = 6261</li><li>金額コミットメント分 96 を減算： 6261 - 96 = 6165</li><li>ノンスコミットメント分 128 を減算： 6165 - 128 = 6037</li><li>二番目の出力ウィットネス (4277) - 2 を減算： 6037 - 4275 = 1762</li><li>金額コミットメント分 96 を減算： 1762 - 96 = 1666</li><li>ノンスコミットメント分 128 を減算： 1666 - 128 = 1538</li></ul><p>割引後の重み： 1538 WU</p><p>割引後の仮想サイズ： (1538 + 3) / 4 = 385 vB</p><h4 id=ノード>ノード<a hidden class=anchor aria-hidden=true href=#ノード>#</a></h4><p>ノードは、これらの割引 CT を受け入れ、リレーするか否かを定義する新たな設定オプションを追加する必要があります。参照実装では、これを &ldquo;accept_discount_ct&rdquo; と呼んでいます。<br>この設定オプションが有効な場合、ノードはミンプールへの受け入れのための手数料率計算およびピアから与えられるフィルタ手数料率に応じたインベントリメッセージへの応答において、vsize の代わりに discountvsize を用いなければなりません。</p><p>ブロックテンプレートアセンブラにおいて、先祖手数料率による順序付けも、手数料あたりの vsize ではなく、手数料あたりの discountvsize を用いるように変更されるべきです。</p><h2 id=backwards_compatibility>後方互換性<a hidden class=anchor aria-hidden=true href=#backwards_compatibility>#</a></h2><p>任意の手数料率、または手数料出力が存在しないトランザクションであっても、LiquidV1 ではコンセンサス上有効であり、Elements ではデフォルトでブロックに含めることが可能です。<br>Elements の現在のデフォルト最低手数料率（0.1 sats/vb）において、上記で規定された割引 CT はアップグレードされていないノードによってリレーされるための最低手数料率を満たしません。<br>割引 CT がアップグレードされたノードを介してブロックマイナ（または署名者）ノードにリレーされることができれば、ブロックに含めることが可能です。<br>アップグレードされたノードが増えるにつれて、これは容易になります。</p><h2 id=reference_implementation>参照実装<a hidden class=anchor aria-hidden=true href=#reference_implementation>#</a></h2><p><a href=https://github.com/ElementsProject/elements/pull/1317>https://github.com/ElementsProject/elements/pull/1317</a></p><h2 id=alternate_implementation>代替実装<a hidden class=anchor aria-hidden=true href=#alternate_implementation>#</a></h2><p><a href=https://github.com/ElementsProject/rust-elements/pull/204>https://github.com/ElementsProject/rust-elements/pull/204</a></p><h2 id=参考文献>参考文献<a hidden class=anchor aria-hidden=true href=#参考文献>#</a></h2><references><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>BIP-0141：
<a href=https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki>https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki</a>
#Transaction_size_calculations&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>BIP-0144：
<a href=https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki>https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki</a>
#user-content-Serialization&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988>https://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://yusukeshimizu.github.io/blog/>blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>