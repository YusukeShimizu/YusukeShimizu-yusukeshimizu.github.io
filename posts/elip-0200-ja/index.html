<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>elip-0200 | blog</title>
<meta name=keywords content><meta name=description content="ELIP 0200の日本語訳。Elements Improvement Proposals (ELIPs) は、BitcoinのBIPに相当するElementsプロジェクトの改善提案である。
この記事はllmによる機械翻訳に基づく。誤りの可能性がある点に留意すること。
この内容はcommit hash
9f08b8168328691c1bff6e0261cebbe985f39ae4
時点のリポジトリを参照している。

ELIP: 200
Layer: Applications
Title: Confidential Transactions の割引料金
Author: Byron Hambly bhambly@blockstream.com
Comments-Summary: まだコメントはない
Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200
Status: Draft
Type: Standards Track
Created: 2024-06-19
License: BSD-3-Clause
はじめに
概要
Confidential Transactions (CT) の取引手数料を割引する方法を提案する。これにより、ウォレットが割引手数料率を算出可能になり、ノードが割引されたCTをリレー・採掘するための要件を定義する。
Copyright
本書は3条項BSDライセンスの下で公開している。
Motivation
ElementsにおけるCTは、明示的な取引よりサイズが約10倍大きい。
Pedersenコミットメントやアセットコミットメント、ECDHエフェメラルキーなどが追加され、さらにレンジプルーフとサージェクションプルーフを含むウィットネスデータが大きな要因である。
サイズが大きいほど手数料が高くなるため、ユーザがCTによるプライバシーを犠牲にし、明示的な取引を選びやすくなる可能性がある。
このELIPは、ElementsでCTを割引料金で受け入れるポリシー変更を提案し、CTと明示的な取引を同等の手数料規模に近づけ、明示的取引優先の動機を下げる。
Design
Overview
新たに「discount virtual size (discountvsize)」を導入する。
明示的な取引では通常のvsizeと実質同じ値となるが、CTでは秘密出力が含まれるたびに、各出力分の重みを仮想サイズ計算の前に減少させる。
ウォレットは、この割引計算を用いて手数料を推定し、ノードはメンプールへの受け入れやピアへのメッセージングでdiscountvsizeを利用する。これによってCT取引の中継と採掘が行われる。
欠点
ディスカウントを導入すると、実際のコストは表面上の手数料率より低くなる。
既存のブロックアセンブラは先祖手数料率が高い取引から優先するため、割引CTは同じ「表面料金率」の明示的トランザクションなどより選択が遅れる。
この状態を解消するには、ブロックアセンブラ側で割引された仮想サイズを基準に手数料率を扱うよう変更が必要だが、最大料金追求よりCTのプライバシー優先を許容するというトレードオフとなる。
仕様
ウォレット
ウォレットは通常の手順で取引を作成し、まずプレースホルダーの手数料出力を含める。
ダミー署名を埋め込んだ後、BIP-01411 に従い以下の式で重みを算出する:
Weight = (Base transaction size * 3) + Total transaction size"><meta name=author content><link rel=canonical href=https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://yusukeshimizu.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yusukeshimizu.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yusukeshimizu.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://yusukeshimizu.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://yusukeshimizu.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/"><meta property="og:site_name" content="blog"><meta property="og:title" content="elip-0200"><meta property="og:description" content="ELIP 0200の日本語訳。Elements Improvement Proposals (ELIPs) は、BitcoinのBIPに相当するElementsプロジェクトの改善提案である。
この記事はllmによる機械翻訳に基づく。誤りの可能性がある点に留意すること。
この内容はcommit hash
9f08b8168328691c1bff6e0261cebbe985f39ae4
時点のリポジトリを参照している。
ELIP: 200
Layer: Applications
Title: Confidential Transactions の割引料金
Author: Byron Hambly bhambly@blockstream.com
Comments-Summary: まだコメントはない
Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200
Status: Draft
Type: Standards Track
Created: 2024-06-19
License: BSD-3-Clause
はじめに 概要 Confidential Transactions (CT) の取引手数料を割引する方法を提案する。これにより、ウォレットが割引手数料率を算出可能になり、ノードが割引されたCTをリレー・採掘するための要件を定義する。
Copyright 本書は3条項BSDライセンスの下で公開している。
Motivation ElementsにおけるCTは、明示的な取引よりサイズが約10倍大きい。
Pedersenコミットメントやアセットコミットメント、ECDHエフェメラルキーなどが追加され、さらにレンジプルーフとサージェクションプルーフを含むウィットネスデータが大きな要因である。
サイズが大きいほど手数料が高くなるため、ユーザがCTによるプライバシーを犠牲にし、明示的な取引を選びやすくなる可能性がある。
このELIPは、ElementsでCTを割引料金で受け入れるポリシー変更を提案し、CTと明示的な取引を同等の手数料規模に近づけ、明示的取引優先の動機を下げる。
Design Overview 新たに「discount virtual size (discountvsize)」を導入する。
明示的な取引では通常のvsizeと実質同じ値となるが、CTでは秘密出力が含まれるたびに、各出力分の重みを仮想サイズ計算の前に減少させる。
ウォレットは、この割引計算を用いて手数料を推定し、ノードはメンプールへの受け入れやピアへのメッセージングでdiscountvsizeを利用する。これによってCT取引の中継と採掘が行われる。
欠点 ディスカウントを導入すると、実際のコストは表面上の手数料率より低くなる。
既存のブロックアセンブラは先祖手数料率が高い取引から優先するため、割引CTは同じ「表面料金率」の明示的トランザクションなどより選択が遅れる。
この状態を解消するには、ブロックアセンブラ側で割引された仮想サイズを基準に手数料率を扱うよう変更が必要だが、最大料金追求よりCTのプライバシー優先を許容するというトレードオフとなる。
仕様 ウォレット ウォレットは通常の手順で取引を作成し、まずプレースホルダーの手数料出力を含める。
ダミー署名を埋め込んだ後、BIP-01411 に従い以下の式で重みを算出する:
Weight = (Base transaction size * 3) + Total transaction size"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-24T16:56:49+09:00"><meta property="article:modified_time" content="2025-03-24T16:56:49+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="elip-0200"><meta name=twitter:description content="ELIP 0200の日本語訳。Elements Improvement Proposals (ELIPs) は、BitcoinのBIPに相当するElementsプロジェクトの改善提案である。
この記事はllmによる機械翻訳に基づく。誤りの可能性がある点に留意すること。
この内容はcommit hash
9f08b8168328691c1bff6e0261cebbe985f39ae4
時点のリポジトリを参照している。

ELIP: 200
Layer: Applications
Title: Confidential Transactions の割引料金
Author: Byron Hambly bhambly@blockstream.com
Comments-Summary: まだコメントはない
Comments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200
Status: Draft
Type: Standards Track
Created: 2024-06-19
License: BSD-3-Clause
はじめに
概要
Confidential Transactions (CT) の取引手数料を割引する方法を提案する。これにより、ウォレットが割引手数料率を算出可能になり、ノードが割引されたCTをリレー・採掘するための要件を定義する。
Copyright
本書は3条項BSDライセンスの下で公開している。
Motivation
ElementsにおけるCTは、明示的な取引よりサイズが約10倍大きい。
Pedersenコミットメントやアセットコミットメント、ECDHエフェメラルキーなどが追加され、さらにレンジプルーフとサージェクションプルーフを含むウィットネスデータが大きな要因である。
サイズが大きいほど手数料が高くなるため、ユーザがCTによるプライバシーを犠牲にし、明示的な取引を選びやすくなる可能性がある。
このELIPは、ElementsでCTを割引料金で受け入れるポリシー変更を提案し、CTと明示的な取引を同等の手数料規模に近づけ、明示的取引優先の動機を下げる。
Design
Overview
新たに「discount virtual size (discountvsize)」を導入する。
明示的な取引では通常のvsizeと実質同じ値となるが、CTでは秘密出力が含まれるたびに、各出力分の重みを仮想サイズ計算の前に減少させる。
ウォレットは、この割引計算を用いて手数料を推定し、ノードはメンプールへの受け入れやピアへのメッセージングでdiscountvsizeを利用する。これによってCT取引の中継と採掘が行われる。
欠点
ディスカウントを導入すると、実際のコストは表面上の手数料率より低くなる。
既存のブロックアセンブラは先祖手数料率が高い取引から優先するため、割引CTは同じ「表面料金率」の明示的トランザクションなどより選択が遅れる。
この状態を解消するには、ブロックアセンブラ側で割引された仮想サイズを基準に手数料率を扱うよう変更が必要だが、最大料金追求よりCTのプライバシー優先を許容するというトレードオフとなる。
仕様
ウォレット
ウォレットは通常の手順で取引を作成し、まずプレースホルダーの手数料出力を含める。
ダミー署名を埋め込んだ後、BIP-01411 に従い以下の式で重みを算出する:
Weight = (Base transaction size * 3) + Total transaction size"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yusukeshimizu.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"elip-0200","item":"https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"elip-0200","name":"elip-0200","description":"ELIP 0200の日本語訳。Elements Improvement Proposals (ELIPs) は、BitcoinのBIPに相当するElementsプロジェクトの改善提案である。\nこの記事はllmによる機械翻訳に基づく。誤りの可能性がある点に留意すること。\nこの内容はcommit hash\n9f08b8168328691c1bff6e0261cebbe985f39ae4\n時点のリポジトリを参照している。\nELIP: 200\nLayer: Applications\nTitle: Confidential Transactions の割引料金\nAuthor: Byron Hambly bhambly@blockstream.com\nComments-Summary: まだコメントはない\nComments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200\nStatus: Draft\nType: Standards Track\nCreated: 2024-06-19\nLicense: BSD-3-Clause\nはじめに 概要 Confidential Transactions (CT) の取引手数料を割引する方法を提案する。これにより、ウォレットが割引手数料率を算出可能になり、ノードが割引されたCTをリレー・採掘するための要件を定義する。\nCopyright 本書は3条項BSDライセンスの下で公開している。\nMotivation ElementsにおけるCTは、明示的な取引よりサイズが約10倍大きい。\nPedersenコミットメントやアセットコミットメント、ECDHエフェメラルキーなどが追加され、さらにレンジプルーフとサージェクションプルーフを含むウィットネスデータが大きな要因である。\nサイズが大きいほど手数料が高くなるため、ユーザがCTによるプライバシーを犠牲にし、明示的な取引を選びやすくなる可能性がある。\nこのELIPは、ElementsでCTを割引料金で受け入れるポリシー変更を提案し、CTと明示的な取引を同等の手数料規模に近づけ、明示的取引優先の動機を下げる。\nDesign Overview 新たに「discount virtual size (discountvsize)」を導入する。\n明示的な取引では通常のvsizeと実質同じ値となるが、CTでは秘密出力が含まれるたびに、各出力分の重みを仮想サイズ計算の前に減少させる。\nウォレットは、この割引計算を用いて手数料を推定し、ノードはメンプールへの受け入れやピアへのメッセージングでdiscountvsizeを利用する。これによってCT取引の中継と採掘が行われる。\n欠点 ディスカウントを導入すると、実際のコストは表面上の手数料率より低くなる。\n既存のブロックアセンブラは先祖手数料率が高い取引から優先するため、割引CTは同じ「表面料金率」の明示的トランザクションなどより選択が遅れる。\nこの状態を解消するには、ブロックアセンブラ側で割引された仮想サイズを基準に手数料率を扱うよう変更が必要だが、最大料金追求よりCTのプライバシー優先を許容するというトレードオフとなる。\n仕様 ウォレット ウォレットは通常の手順で取引を作成し、まずプレースホルダーの手数料出力を含める。\nダミー署名を埋め込んだ後、BIP-01411 に従い以下の式で重みを算出する:\nWeight = (Base transaction size * 3) + Total transaction size\n","keywords":[],"articleBody":"ELIP 0200の日本語訳。Elements Improvement Proposals (ELIPs) は、BitcoinのBIPに相当するElementsプロジェクトの改善提案である。\nこの記事はllmによる機械翻訳に基づく。誤りの可能性がある点に留意すること。\nこの内容はcommit hash\n9f08b8168328691c1bff6e0261cebbe985f39ae4\n時点のリポジトリを参照している。\nELIP: 200\nLayer: Applications\nTitle: Confidential Transactions の割引料金\nAuthor: Byron Hambly bhambly@blockstream.com\nComments-Summary: まだコメントはない\nComments-URI: https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200\nStatus: Draft\nType: Standards Track\nCreated: 2024-06-19\nLicense: BSD-3-Clause\nはじめに 概要 Confidential Transactions (CT) の取引手数料を割引する方法を提案する。これにより、ウォレットが割引手数料率を算出可能になり、ノードが割引されたCTをリレー・採掘するための要件を定義する。\nCopyright 本書は3条項BSDライセンスの下で公開している。\nMotivation ElementsにおけるCTは、明示的な取引よりサイズが約10倍大きい。\nPedersenコミットメントやアセットコミットメント、ECDHエフェメラルキーなどが追加され、さらにレンジプルーフとサージェクションプルーフを含むウィットネスデータが大きな要因である。\nサイズが大きいほど手数料が高くなるため、ユーザがCTによるプライバシーを犠牲にし、明示的な取引を選びやすくなる可能性がある。\nこのELIPは、ElementsでCTを割引料金で受け入れるポリシー変更を提案し、CTと明示的な取引を同等の手数料規模に近づけ、明示的取引優先の動機を下げる。\nDesign Overview 新たに「discount virtual size (discountvsize)」を導入する。\n明示的な取引では通常のvsizeと実質同じ値となるが、CTでは秘密出力が含まれるたびに、各出力分の重みを仮想サイズ計算の前に減少させる。\nウォレットは、この割引計算を用いて手数料を推定し、ノードはメンプールへの受け入れやピアへのメッセージングでdiscountvsizeを利用する。これによってCT取引の中継と採掘が行われる。\n欠点 ディスカウントを導入すると、実際のコストは表面上の手数料率より低くなる。\n既存のブロックアセンブラは先祖手数料率が高い取引から優先するため、割引CTは同じ「表面料金率」の明示的トランザクションなどより選択が遅れる。\nこの状態を解消するには、ブロックアセンブラ側で割引された仮想サイズを基準に手数料率を扱うよう変更が必要だが、最大料金追求よりCTのプライバシー優先を許容するというトレードオフとなる。\n仕様 ウォレット ウォレットは通常の手順で取引を作成し、まずプレースホルダーの手数料出力を含める。\nダミー署名を埋め込んだ後、BIP-01411 に従い以下の式で重みを算出する:\nWeight = (Base transaction size * 3) + Total transaction size\nBase transaction sizeはウィットネスを除いたサイズ Total transaction sizeはBIP-01442に準拠し、ベースデータとウィットネスデータをすべて含むサイズ 次に、割引ウエイトを計算する。出力ウィットネスがある場合はウィットネスを差し引き、2ウエイト単位のみを残す形で計上する。さらに、金額がコミットメントの場合は33バイトと明示額の9バイト差を非ウィットデータとして4倍し、96単位を減算する。ノンスがコミットメントなら同じ要領で128単位を減算する。\n最終的に:\ndiscountvsize = (discount weight + 3) / 4\nこれを使い:\n手数料出力額 = chosen fee rate * discountvsize\n手数料出力自体は割引計算対象外とする。\n計算例 LiquidV13 のトランザクション例:\nCT出力が2つ、手数料出力が1つ 重み: 10536 WU 以下のステップでディスカウント重みへ変換する:\n1つ目の出力ウィットネス (4277) - 2 = 4275 を差し引く\n10536 - 4275 = 6261 金額コミットメント 96 を差し引き\n6261 - 96 = 6165 ノンスコミットメント 128 を差し引き\n6165 - 128 = 6037 2つ目の出力ウィットネス (4277) - 2 = 4275 を差し引く\n6037 - 4275 = 1762 金額コミットメント 96 を差し引き\n1762 - 96 = 1666 ノンスコミットメント 128 を差し引き\n1666 - 128 = 1538 割引後の重み: 1538 WU discountvsize = (1538 + 3) / 4 = 385 vB\nノード ノードは新たなオプション “accept_discount_ct” を通して、ディスカウントCTのリレーを許可するかを決定する。\n有効化すると、ミンプールの受け入れ判断やピアのフィルタ料金率計算でvsizeの代わりにdiscountvsizeを使用する。\nさらにはブロックテンプレートアセンブラも、手数料率計算をdiscountvsizeベースに変更する必要がある。\n後方互換性 LiquidV1では、任意の手数料率や手数料出力なし取引もコンセンサス的には有効である。\n既存のElementsの最低手数料率(0.1 sats/vb)下では、割引CTはアップグレードされていないノードのリレー基準を満たさない。\nただし、アップグレード済みノード経由でマイナーノードへ到達できればブロックに取り込まれる。\nアップグレードノードが増えると、現実的にリレーが広がる。\n参照実装 https://github.com/ElementsProject/elements/pull/1317\n代替実装 https://github.com/ElementsProject/rust-elements/pull/204\n参考文献 BIP-0141\nhttps://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki\n#Transaction_size_calculations ↩︎\nBIP-0144\nhttps://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki\n#user-content-Serialization ↩︎\nhttps://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988 ↩︎\n","wordCount":"203","inLanguage":"en","datePublished":"2025-03-24T16:56:49+09:00","dateModified":"2025-03-24T16:56:49+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://yusukeshimizu.github.io/blog/posts/elip-0200-ja/"},"publisher":{"@type":"Organization","name":"blog","logo":{"@type":"ImageObject","url":"https://yusukeshimizu.github.io/blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yusukeshimizu.github.io/blog/ accesskey=h title="blog (Alt + H)">blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">elip-0200</h1><div class=post-meta><span title='2025-03-24 16:56:49 +0900 +0900'>March 24, 2025</span></div></header><div class=post-content><p>ELIP 0200の日本語訳。Elements Improvement Proposals (ELIPs) は、BitcoinのBIPに相当するElementsプロジェクトの改善提案である。</p><p>この記事はllmによる機械翻訳に基づく。誤りの可能性がある点に留意すること。<br>この内容はcommit hash<br><a href=https://github.com/ElementsProject/ELIPs/tree/9f08b8168328691c1bff6e0261cebbe985f39ae4>9f08b8168328691c1bff6e0261cebbe985f39ae4</a><br>時点のリポジトリを参照している。</p><hr><p>ELIP: 200<br>Layer: Applications<br>Title: Confidential Transactions の割引料金<br>Author: Byron Hambly <a href=mailto:bhambly@blockstream.com>bhambly@blockstream.com</a><br>Comments-Summary: まだコメントはない<br>Comments-URI: <a href=https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200>https://github.com/ElementsProject/elips/wiki/Comments:ELIP-0200</a><br>Status: Draft<br>Type: Standards Track<br>Created: 2024-06-19<br>License: BSD-3-Clause</p><h2 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h2><h3 id=概要>概要<a hidden class=anchor aria-hidden=true href=#概要>#</a></h3><p>Confidential Transactions (CT) の取引手数料を割引する方法を提案する。これにより、ウォレットが割引手数料率を算出可能になり、ノードが割引されたCTをリレー・採掘するための要件を定義する。</p><h3 id=copyright>Copyright<a hidden class=anchor aria-hidden=true href=#copyright>#</a></h3><p>本書は3条項BSDライセンスの下で公開している。</p><h3 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h3><p>ElementsにおけるCTは、明示的な取引よりサイズが約10倍大きい。<br>Pedersenコミットメントやアセットコミットメント、ECDHエフェメラルキーなどが追加され、さらにレンジプルーフとサージェクションプルーフを含むウィットネスデータが大きな要因である。<br>サイズが大きいほど手数料が高くなるため、ユーザがCTによるプライバシーを犠牲にし、明示的な取引を選びやすくなる可能性がある。<br>このELIPは、ElementsでCTを割引料金で受け入れるポリシー変更を提案し、CTと明示的な取引を同等の手数料規模に近づけ、明示的取引優先の動機を下げる。</p><h2 id=design>Design<a hidden class=anchor aria-hidden=true href=#design>#</a></h2><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><p>新たに「discount virtual size (discountvsize)」を導入する。<br>明示的な取引では通常のvsizeと実質同じ値となるが、CTでは秘密出力が含まれるたびに、各出力分の重みを仮想サイズ計算の前に減少させる。</p><p>ウォレットは、この割引計算を用いて手数料を推定し、ノードはメンプールへの受け入れやピアへのメッセージングでdiscountvsizeを利用する。これによってCT取引の中継と採掘が行われる。</p><h3 id=欠点>欠点<a hidden class=anchor aria-hidden=true href=#欠点>#</a></h3><p>ディスカウントを導入すると、実際のコストは表面上の手数料率より低くなる。<br>既存のブロックアセンブラは先祖手数料率が高い取引から優先するため、割引CTは同じ「表面料金率」の明示的トランザクションなどより選択が遅れる。<br>この状態を解消するには、ブロックアセンブラ側で割引された仮想サイズを基準に手数料率を扱うよう変更が必要だが、最大料金追求よりCTのプライバシー優先を許容するというトレードオフとなる。</p><h3 id=仕様>仕様<a hidden class=anchor aria-hidden=true href=#仕様>#</a></h3><h4 id=ウォレット>ウォレット<a hidden class=anchor aria-hidden=true href=#ウォレット>#</a></h4><p>ウォレットは通常の手順で取引を作成し、まずプレースホルダーの手数料出力を含める。<br>ダミー署名を埋め込んだ後、BIP-0141<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> に従い以下の式で重みを算出する:</p><p>Weight = (Base transaction size * 3) + Total transaction size</p><ul><li>Base transaction sizeはウィットネスを除いたサイズ</li><li>Total transaction sizeはBIP-0144<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>に準拠し、ベースデータとウィットネスデータをすべて含むサイズ</li></ul><p>次に、割引ウエイトを計算する。出力ウィットネスがある場合はウィットネスを差し引き、2ウエイト単位のみを残す形で計上する。さらに、金額がコミットメントの場合は33バイトと明示額の9バイト差を非ウィットデータとして4倍し、96単位を減算する。ノンスがコミットメントなら同じ要領で128単位を減算する。</p><p>最終的に:</p><p>discountvsize = (discount weight + 3) / 4</p><p>これを使い:</p><p>手数料出力額 = chosen fee rate * discountvsize</p><p>手数料出力自体は割引計算対象外とする。</p><h5 id=計算例>計算例<a hidden class=anchor aria-hidden=true href=#計算例>#</a></h5><p>LiquidV1<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> のトランザクション例:</p><ul><li>CT出力が2つ、手数料出力が1つ</li><li>重み: 10536 WU</li></ul><p>以下のステップでディスカウント重みへ変換する:</p><ol><li>1つ目の出力ウィットネス (4277) - 2 = 4275 を差し引く<br>10536 - 4275 = 6261</li><li>金額コミットメント 96 を差し引き<br>6261 - 96 = 6165</li><li>ノンスコミットメント 128 を差し引き<br>6165 - 128 = 6037</li><li>2つ目の出力ウィットネス (4277) - 2 = 4275 を差し引く<br>6037 - 4275 = 1762</li><li>金額コミットメント 96 を差し引き<br>1762 - 96 = 1666</li><li>ノンスコミットメント 128 を差し引き<br>1666 - 128 = 1538</li></ol><p>割引後の重み: 1538 WU<br>discountvsize = (1538 + 3) / 4 = 385 vB</p><h4 id=ノード>ノード<a hidden class=anchor aria-hidden=true href=#ノード>#</a></h4><p>ノードは新たなオプション &ldquo;accept_discount_ct&rdquo; を通して、ディスカウントCTのリレーを許可するかを決定する。<br>有効化すると、ミンプールの受け入れ判断やピアのフィルタ料金率計算でvsizeの代わりにdiscountvsizeを使用する。<br>さらにはブロックテンプレートアセンブラも、手数料率計算をdiscountvsizeベースに変更する必要がある。</p><h2 id=後方互換性>後方互換性<a hidden class=anchor aria-hidden=true href=#後方互換性>#</a></h2><p>LiquidV1では、任意の手数料率や手数料出力なし取引もコンセンサス的には有効である。<br>既存のElementsの最低手数料率(0.1 sats/vb)下では、割引CTはアップグレードされていないノードのリレー基準を満たさない。<br>ただし、アップグレード済みノード経由でマイナーノードへ到達できればブロックに取り込まれる。<br>アップグレードノードが増えると、現実的にリレーが広がる。</p><h2 id=参照実装>参照実装<a hidden class=anchor aria-hidden=true href=#参照実装>#</a></h2><p><a href=https://github.com/ElementsProject/elements/pull/1317>https://github.com/ElementsProject/elements/pull/1317</a></p><h2 id=代替実装>代替実装<a hidden class=anchor aria-hidden=true href=#代替実装>#</a></h2><p><a href=https://github.com/ElementsProject/rust-elements/pull/204>https://github.com/ElementsProject/rust-elements/pull/204</a></p><h2 id=参考文献>参考文献<a hidden class=anchor aria-hidden=true href=#参考文献>#</a></h2><references><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>BIP-0141<br><a href=https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki>https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki</a><br>#Transaction_size_calculations&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>BIP-0144<br><a href=https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki>https://github.com/bitcoin/bips/blob/master/bip-0144.mediawiki</a><br>#user-content-Serialization&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988>https://blockstream.info/liquid/tx/221c8a8bb81d1e33f3b6556ec9eb10815469ff02fd4bb4dd5127442eaa16d988</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://yusukeshimizu.github.io/blog/>blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>